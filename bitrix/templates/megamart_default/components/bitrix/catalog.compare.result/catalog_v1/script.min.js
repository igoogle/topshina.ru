BX.namespace("BX.Iblock.Catalog"),BX.Iblock.Catalog.CompareClass=function(){var t=function(t){this.errorCode=0,this.obCompare=null,this.node={},this.config={name:"CATALOG_COMPARE_LIST",iblockId:null},this.items=[],this.obItems=[],this.hoverStateChangeForbidden=!1,"object"==typeof t&&(this.visual=t.VISUAL,this.config.name=t.CONFIG.NAME,this.config.iblockId=t.CONFIG.IBLOCK_ID,this.ajaxUrl=t.CONFIG.TEMPLATE_FOLDER+"/ajax.php",this.items=t.ITEMS),this.breakpoints={xxs:0,xs:380,sm:576,md:768,lg:992,xl:1200},0===this.errorCode&&BX.ready(BX.delegate(this.init,this)),this.obCompare=BX(this.visual.ID),BX.addCustomEvent(window,"OnCompareSort",BX.proxy(this.compareSort,this))};return t.prototype.MakeAjaxAction=function(t,e){this.showWait(),BX.ajax.post(t,{ajax_action:"Y",ajax_id:this.visual.ID},BX.proxy(this.reloadResult,this)),e&&BX.PreventDefault(e)},t.prototype.reloadResult=function(t){this.obCompare.innerHTML=t,this.init(),this.closeWait()},t.prototype.init=function(){var t;if(this.obTable=BX(this.visual.TABLE),this.obCompare||(this.errorCode=-1),this.showWait(),this.node.columnNames=this.obCompare.querySelector('[data-entity="column-names"]'),this.node.columnItems=this.obCompare.querySelector('[data-entity="column-items"]'),this.node.itemsTable=this.obCompare.querySelector('[data-entity="items-table"]'),this.obItems=[],this.node.itemsTable){var e=this.node.itemsTable.querySelectorAll('[data-entity="compare-item"]');for(t in e)e.hasOwnProperty(t)&&this.obItems.push(e[t])}for(t in this.obItems)this.compareItemDragInit(this.obItems[t].parentNode),BX.bind(this.obItems[t],"mouseenter",BX.proxy(this.hoverOn,this)),BX.bind(this.obItems[t],"mouseleave",BX.proxy(this.hoverOff,this));this.setRhythm();var i=this.node.columnItems;$(this.node.columnItems).children(":first").scrollbar({onUpdate:function(t){var e=$(i).find("thead"),o=$(this.wrapper).find(".scroll-element.scroll-x");o.css({top:e.position().top+e.outerHeight()+$(i).find("tbody > tr:first-child").outerHeight()/2-o.outerHeight()/2})}}),new BX.easing({duration:1e3,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.linear),step:BX.proxy(function(t){this.obTable.style.opacity=t.opacity/100},this),complete:BX.proxy(function(){this.closeWait(),this.obTable.removeAttribute("style")},this)}).animate(),$(window).on("resize",BX.debounce($.proxy(this.setRhythm,this),250))},t.prototype.compareSort=function(){var t={action:"compare-sort",ITEMS:[]};if(this.node.itemsTable){var e=this.node.itemsTable.querySelectorAll('[data-entity="compare-item"]');for(i in e)if(e.hasOwnProperty(i)){var o=this.obItems.indexOf(e[i]);t.ITEMS.push(this.items[o])}}this.sendRequest(t)},t.prototype.sendRequest=function(t){var e={siteId:this.siteId,AJAX:"Y",NAME:this.config.name,IBLOCK_ID:this.config.iblockId};BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:BX.merge(e,t),onsuccess:BX.delegate(function(e){this.showAction(e,t)},this)})},t.prototype.showAction=function(t,e){if(e)switch(e.action){case"compare-sort":this.compareSortResult(t)}},t.prototype.compareSortResult=function(){},t.prototype.setRhythm=function(){var t=BX.findChildren(this.node.itemsTable,{tag:"tr"},!0),e=BX.findChildren(this.node.columnNames,{tag:"tr"},!0);if(e&&e.length>0&&t&&t.length){var o=-1,r={};for(var s in r[this.breakpoints.xxs]={items:1},r[this.breakpoints.sm]={items:2},r[this.breakpoints.lg]={items:3},r)(s=Number(s))<=this.getWidth()&&s>o&&(o=s);for(this.node.itemsTable.style.width=100*BX.findChildren(t[0],{tag:"td"},!0).length/r[o].items+"%",i=0;e.length>i;i++)e[i].style.height=t[i].style.height="auto",t[i].offsetHeight>e[i].offsetHeight?e[i].style.height=t[i].offsetHeight+"px":t[i].style.height=e[i].offsetHeight+"px"}},t.prototype.showWait=function(){BX.addClass(this.obTable,"overlay is-loading")},t.prototype.closeWait=function(){BX.removeClass(this.obTable,"overlay is-loading")},t.prototype.compareItemDragStart=function(){var t=document.body.appendChild(document.createElement("DIV"));return t.style.position="absolute",t.style.zIndex=1100,t.className="bx-drag-object",t.innerHTML=this.innerHTML,t.style.width=this.clientWidth+"px",this.__dragCopyDiv=t,!0},t.prototype.compareItemDrag=function(t,e,i){var o,r=this.__dragCopyDiv,s=this.__currentDest;if(null==this.__dragOffset&&(this.__dragOffset={left:this.__bxpos[0]-t,top:this.__bxpos[1]-e}),r.style.left=t+this.__dragOffset.left+"px",r.style.top=e+this.__dragOffset.top+"px",o=null==s?this:s){var n=BX.findChildren(o.parentNode,{},!1).indexOf(o),a=BX.findParent(o,{tagName:"table"});if(a){var h=BX.findChildren(a,{tagName:"tr"},!0);if(h.length)for(var l in h)for(var p=0;p<h[l].children.length;p++)h[l].children.item(p).style.opacity=p==n?"":"0.5"}}return!0},t.prototype.compareItemDragStop=function(t,e,i){this.className=this.className.replace(/\s*bx-grid-drag-source/gi,""),this.__dragCopyDiv.parentNode.removeChild(this.__dragCopyDiv),this.__dragCopyDiv=null,this.__dragOffset=null;if(this){var o=BX.findParent(this,{tagName:"table"});if(o){var r=BX.findChildren(o,{tagName:"tr"},!0);if(r.length)for(var s in r)for(var n=0;n<r[s].children.length;n++)r[s].children.item(n).style.opacity=""}}return!0},t.prototype.compareItemDragHover=function(t,e,i){this.__currentDest=this!=t?t:null},t.prototype.compareItemDragOut=function(t,e,i){},t.prototype.compareItemDestDragFinish=function(t,e,i,o){var r=BX.findChildren(t.parentNode),s=r.indexOf(t),n=r.indexOf(this),a=BX.pos(this),h=BX.findParent(this,{tagName:"table"});if(h){var l=BX.findChildren(h,{tagName:"tr"},!0);if(l.length)for(var p in l){var d=l[p].children.item(s),m=l[p].children.item(n);d&&m&&(e-a.left<a.width/2?m.parentNode.insertBefore(d,m):m.parentNode.insertBefore(d,m.nextSibling))}}BX.onCustomEvent("OnCompareSort")},t.prototype.compareItemDragInit=function(t){null==t.onbxdragstart&&(t.onbxdragstart=this.compareItemDragStart,t.onbxdragstop=this.compareItemDragStop,t.onbxdrag=this.compareItemDrag,t.onbxdraghover=this.compareItemDragHover,t.onbxdraghout=this.compareItemDragOut,t.onbxdestdragfinish=this.compareItemDestDragFinish,jsDD.registerObject(t),jsDD.registerDest(t),BX.unbind(t,"mouseover",BX.proxy(this.compareItemDragInit,this)))},t.prototype.getWidth=function(){return BX.GetWindowSize().innerWidth},t.prototype.hoverOn=function(t){var e=BX.proxy_context;clearTimeout(this.hoverTimer),e.style.height=getComputedStyle(e).height,BX.addClass(e,"hover"),BX.PreventDefault(t)},t.prototype.hoverOff=function(t){if(!this.hoverStateChangeForbidden){var e=BX.proxy_context;BX.removeClass(e,"hover"),e.style.height="",BX.PreventDefault(t)}},t.prototype.columnHoverOn=function(t){},t.prototype.columnHoverOff=function(t){},t}();